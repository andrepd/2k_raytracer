#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#define f double
#define i int 
#define Y return
#define O operator
#define R (f)rand()/RAND_MAX
f P=M_PI;f M(f x){Y(x>0)*x;}struct v{f x,y,z;v(f a=0,f b=0,f c=0){x=a;y=b;z=c;};v O+(v o){Y{x+o.x,y+o.y,z+o.z};}v O-(v o){Y*this+o*-1.;}v O*(f o){Y{o*x,o*y,o*z};}f O*(v o){Y{x*o.x+y*o.y+z*o.z};}v O!(){Y*this*(1./sqrt(*this**this));}};v O*(f a,v o){Y o*a;}i z(f x){Y abs(x)<1e-4;}f B(v o,v d){f t=-1*o*d,l=o*o-t*t;if(l>1)Y 0;f u=sqrt(1-l),a=t-u,b=t+u;Y a>0?a:(b>0?b:0);}v S(v x,f a,f b){Y{cos(b)*x.x+0+sin(b)*x.z,sin(a)*sin(b)*x.x+cos(a)*x.y-sin(a)*cos(b)*x.z,-cos(a)*sin(b)*x.x+sin(a)*x.y+cos(a)*cos(b)*x.z};}v J(v x,f e){f t=(R-.5)*P*e,p=(R-.5)*P*e;Y S(x,t,p);}v K={3,2.5,2.5};v S(v o,v d,i N){N--;v p;f t=B(o,d);if(t>0&&N){v p=o+t*d,n=!p,q=S(p,P/5,-P/3.5),C=abs(q.z)<cos(2*P/5.)?v(78,191,246):v(253,252,0);f x=(atan2(q.y,q.x)+P)/2/P,A=.16*P,B=.27*P,a=A*cos(P/5)/(A*sin(P/5)-B),b=tan(abs(fmod(x,0.2)-0.1)*2*P),c=pow(a*B/(a-b),2)*(1+b*b);if(q.z>cos(c))C={248,24,24};v r=d-2*(d*n)*n,L=K-p;C=C*(M(!L*!n)*.85+.15);v D=S(p+1e-6*n,!J(r,0.05),N),H=pow(M(r*!L),30)*255*v(1,1,1);Y.82*C+.1*D+.25*H;}else{v W[]={{-3,0,0},{0,9,0},{0,-2,0},{0,0,-1},{8,0,0},{0,0,8}};v n;f u=1e9;for(v w:W){f t=d*w>1e-6?(w-o)*w/(d*w):1e9;if(t<u){u=t;n=w;p=o+t*d;}}v a={192,192,192},b={184,50,50},L=K+.15*v(R,R,R)-p;f I,s=B(p,!L);if(s>0&&s*s<L*L){I=0.15;}else{I=M(-1.*!L*!n)*(0.5+0.3*(1-tanh(16*acos(!L*!K)-2.7*P)));}p=p-n;if(z(p.x)){Y(i(p.y*2+8)+i(p.z*2+8))&1?a*I:b*I;}else if(z(p.y)){Y(i(p.z*2+8)+i(p.x*2+8))&1?b*I:a*I;}else{v r=d-2*(d*n)*n;Y((i(p.x*2+8)+i(p.y*2+8))&1?v(28,28,28)*I:a*I)+.25*S(p+n,!J(r,0.08),N);}}}i main(){printf("P6 960 960 255 ");v a=v(6,.1,1),b=!v(-1,0,0),c=!v(0,0,1),d=!v(-.2,1,0);f fd=5.1;for(i y=960;y--;){for(i x=960;x--;){v p={13,13,13};for(i r=64;r--;){v t=.1*(c*(R-.5)+d*(R-.5));p=p+1./64*S(a+t,!(b+0.00125*(d*(480-x+R)-c*(480-y+R))-1./fd*t),8);}if(p.x>=255)p.x=255;if(p.y>=255)p.y=255;if(p.z>=255)p.z=255;printf("%c%c%c",i(p.x),i(p.y),i(p.z));}}}